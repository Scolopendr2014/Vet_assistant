---
description: Структура проекта, стиль кода, проверки перед коммитом
globs: lib/**/*.dart, test/**/*.dart, pubspec.yaml, analysis_options.yaml
alwaysApply: false
---

# Соглашения проекта «Ассистент ветеринара»

## Структура кода (Clean Architecture)

- **Фичи** живут в `lib/features/<feature>/` с подпапками:
  - `data/` — репозитории (impl), мапперы, источники данных
  - `domain/` — сущности, интерфейсы репозиториев, доменная логика
  - `presentation/` — страницы (pages), провайдеры (providers), виджеты (widgets)
- **Общее** — `lib/core/`: конфиг (`config/`), БД (`database/`), DI (`di/`).
- Не смешивать слои: domain не зависит от data и presentation; data не импортирует presentation.

## Стиль и линтер

- Следовать [analysis_options.yaml](../../analysis_options.yaml): `prefer_const_constructors`, `prefer_single_quotes`, `always_declare_return_types`, `avoid_print` и т.д.
- Перед коммитом: **`flutter analyze`** без ошибок, **`flutter test`** — все тесты зелёные.
- Новый код в фичах — по той же структуре (data/domain/presentation), без дублирования логики в UI.

## Тесты

- Юнит-тесты — в `test/`, имена файлов `*_test.dart`.
- При добавлении новой фичи или исправлении бага учитывать необходимость тестов (репозитории, сервисы, маппинг). Существующие тесты не ломать.
- Тестовая БД: `AppDatabase.forTest()` (in-memory) для изоляции.

## Документация и артефакты

- При изменении поведения, связанного с артефактом (VET-XXX), при необходимости обновлять [docs/ARTIFACTS.md](docs/ARTIFACTS.md) и [docs/BUGS.md](docs/BUGS.md) (статус, описание). Новые баги/задачи регистрировать в ARTIFACTS.md с следующим свободным VET-NNN.
- Комментарии в коде и docstrings — на русском; идентификаторы (имена классов, методов, переменных) — на английском. Сообщения коммитов — по [CONTRIBUTING.md](../../CONTRIBUTING.md) с указанием VET-XXX.

## Ветки и коммиты (напоминание для AI)

- Рекомендуемый формат коммита: `fix(VET-XXX): описание` или `feat(VET-XXX): описание`.
- В описании MR/коммита указывать ID артефакта из реестра. Не придумывать новые номера задач — использовать существующие из ARTIFACTS.md или добавить новую строку в реестр.
