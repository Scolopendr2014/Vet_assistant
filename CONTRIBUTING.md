# Руководство по участию в разработке

## Система контроля версий

Проект использует **Git** для контроля версий и **GitLab** для хостинга репозитория.

## Структура веток

Проект следует модели **Git Flow**:

- `main` - стабильная версия (production-ready)
- `develop` - ветка разработки (интеграционная)
- `feature/*` - функциональные ветки
- `hotfix/*` - срочные исправления
- `release/*` - подготовка релизов

## Процесс разработки

### 1. Создание функциональной ветки

Перед началом работы заведите или найдите артефакт в [docs/ARTIFACTS.md](docs/ARTIFACTS.md) (баг, задача, требование) и используйте его ID в имени ветки и в коммитах.

```bash
# Переключитесь на develop
git checkout develop
git pull origin develop

# Создайте ветку с привязкой к артефакту (рекомендуется)
git checkout -b feature/VET-001-pdf-cyrillic-font
# или
git checkout -b feature/VET-002-photos-in-pdf

# Либо без ID:
git checkout -b feature/название-функции
```

### 2. Работа над функцией

```bash
# Делайте коммиты по мере разработки
git add .
git commit -m "feat(patients): добавлен CRUD для пациентов"

# Периодически синхронизируйтесь с develop
git checkout develop
git pull origin develop
git checkout feature/название-функции
git merge develop
```

### 3. Завершение работы

```bash
# Убедитесь, что все изменения закоммичены
git status

# Отправьте ветку на сервер
git push origin feature/название-функции

# Создайте Merge Request в GitLab
# После ревью и одобрения - merge в develop
```

## Формат коммитов

**Все изменения в проекте привязываются к зарегистрированным артефактам.** Реестр артефактов и сквозная нумерация (VET-001, VET-002, …): [docs/ARTIFACTS.md](docs/ARTIFACTS.md).

Используйте следующий формат сообщений коммитов:

```
<тип>(<артефакт>): <краткое описание>

<подробное описание (опционально)>
```

В `<артефакт>` укажите **ID артефакта** (например, `VET-001`) или область кода, если коммит не относится к конкретному артефакту. Для исправления багов и реализации задач из реестра обязательно указывайте ID.

### Типы коммитов:

- `feat` - новая функциональность
- `fix` - исправление бага
- `docs` - изменения в документации
- `style` - форматирование кода (не влияет на функциональность)
- `refactor` - рефакторинг кода
- `test` - добавление или изменение тестов
- `chore` - обновление зависимостей, конфигурации

### Примеры (с привязкой к артефактам):

```bash
git commit -m "fix(VET-001): подключен шрифт с кириллицей для генерации PDF"
git commit -m "feat(VET-002): UI привязки фото к протоколу, вставка в PDF"
git commit -m "feat(VET-011): добавлен поиск пациентов по кличке"
git commit -m "fix(VET-001): исправлено отображение русских символов в PDF"
git commit -m "docs(VET-001): обновлён BUGS.md после исправления"
```

Если коммит затрагивает несколько артефактов, укажите основной в заголовке, остальные — в теле сообщения:

```bash
git commit -m "feat(VET-003): импорт из JSON с отчётом

Ref: VET-003, затронуты VET-035, VET-036"
```

## Code Review

Все изменения должны проходить через Code Review:

1. Создайте Merge Request в GitLab
2. Укажите описание изменений
3. Дождитесь одобрения от других разработчиков
4. После одобрения - выполните merge

## Тестирование

Перед созданием Merge Request убедитесь:

- ✅ Код проходит `flutter analyze`
- ✅ Все тесты проходят (`flutter test`)
- ✅ Код соответствует стилю проекта
- ✅ Документация обновлена (если нужно)

## Работа с конфликтами

При возникновении конфликтов при merge:

```bash
# Обновите вашу ветку
git checkout feature/ваша-ветка
git pull origin develop

# Разрешите конфликты вручную
# Затем:
git add .
git commit -m "merge: разрешены конфликты с develop"
```

## Релизы

Релизы создаются через теги:

```bash
# Переключитесь на main
git checkout main
git pull origin main

# Создайте тег
git tag -a v1.0.0 -m "Release version 1.0.0"

# Отправьте тег
git push origin v1.0.0
```

---

**Важно:** Всегда синхронизируйтесь с `develop` перед началом новой работы и перед созданием Merge Request.
