# Настройка памяти для Docker Desktop (Windows, WSL 2)

## Почему нет пункта Memory в Settings → Resources

В **режиме WSL 2** (он включён по умолчанию) Docker Desktop не показывает настройки CPU и Memory в интерфейсе. Память и процессоры выделяет **Windows** для всей подсистемы WSL 2, а не Docker отдельно.

Поэтому пункт **Memory** в **Settings → Resources → Advanced** есть только при использовании **Hyper-V**. В WSL 2 лимит задаётся через файл **.wslconfig**.

---

## Как выделить больше памяти для WSL 2 (и для Docker/GitLab)

### 1. Создать или изменить файл .wslconfig

1. Откройте папку своего пользователя:
   - Нажмите **Win + R**, введите `%USERPROFILE%`, Enter.
2. В этой папке создайте или откройте файл **`.wslconfig`** (с точкой в начале имени).
3. Заполните или замените содержимое на:

```ini
[wsl2]
memory=8GB
processors=4
swap=2GB
```

- **memory** — сколько ОЗУ выделить WSL 2 (для GitLab лучше **6–8 ГБ**).
- **processors** — число ядер CPU (можно оставить 4 или поставить больше, если ПК позволяет).
- **swap** — файл подкачки внутри WSL 2 (по желанию).

4. Сохраните файл.

### 2. Применить настройки

WSL 2 читает `.wslconfig` только при запуске. Нужно **полностью выключить WSL** и снова его запустить:

1. Закройте все окна WSL (Ubuntu, терминалы внутри WSL и т.п.).
2. Закройте **Docker Desktop** (правый клик по иконке в трее → Quit Docker Desktop).
3. В **PowerShell или cmd от имени администратора** выполните:

```powershell
wsl --shutdown
```

4. Подождите несколько секунд, затем снова запустите **Docker Desktop**.

После этого WSL 2 (и все контейнеры, включая GitLab) будут использовать новый лимит памяти.

### 3. Проверить (опционально)

После запуска Docker и контейнеров можно в WSL проверить доступную память:

```bash
wsl -e free -h
```

Или в PowerShell: `wsl free -h`

---

## Если нужен пункт Memory в интерфейсе Docker

Тогда нужно переключить Docker Desktop на **Hyper-V** вместо WSL 2:

1. Docker Desktop → **Settings** → **General**.
2. Снимите галочку **"Use the WSL 2 based engine"**.
3. **Apply & Restart**.

После перезапуска появятся **Settings → Resources → Advanced** с полями **Memory**, **CPU**, **Swap**. Минус — в Hyper-V режиме работа с диском и сетью часто медленнее, чем в WSL 2. Для тяжёлых контейнеров (GitLab) обычно удобнее оставить WSL 2 и настроить память через **.wslconfig**, как выше.
