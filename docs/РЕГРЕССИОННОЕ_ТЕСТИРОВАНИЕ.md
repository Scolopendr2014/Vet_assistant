# Карта регрессионного тестирования (VET-124)

**Цель:** ручная (или полуавтоматическая) регрессия перед релизом и после крупных изменений. Чек-лист сценариев для проверки ключевых сценариев приложения.

**Артефакт:** VET-124 ([ARTIFACTS.md](ARTIFACTS.md)).

---

## Когда проводить

- Перед релизом (например, 1.3).
- После крупных изменений (версии шаблонов, редактор шаблонов, экспорт/импорт).
- После исправления багов из [BUGS.md](BUGS.md) в затронутых модулях.

---

## 1. Пациенты

| # | Сценарий | Шаги | Ожидаемый результат | Артефакт |
|---|----------|------|----------------------|----------|
| 1.1 | Добавление пациента | Список пациентов → «Добавить» → заполнить кличку, чип, ФИО владельца, контакты → Сохранить | Пациент появляется в списке | VET-010 |
| 1.2 | Редактирование пациента | Карточка пациента → иконка редактирования → изменить данные → Сохранить | Изменения отображаются в карточке и списке | VET-010 |
| 1.3 | Поиск по кличке | Поле поиска → ввести кличку (частично или полностью) | В списке только подходящие пациенты | VET-011 |
| 1.4 | Поиск по чипу | Поле поиска → ввести номер чипа | Найден пациент с этим чипом | VET-011 |
| 1.5 | Поиск по ФИО владельца | Поле поиска → ввести ФИО (частично) | В списке пациенты с подходящим владельцем | VET-011 |
| 1.6 | Лимит 10 пациентов (бесплатная версия) | Добавить 11-го пациента при лимите 10 | Сообщение о лимите или блокировка добавления | VET-014 |
| 1.7 | Список и карточка | Открыть карточку пациента → список протоколов | Отображаются все протоколы осмотра по пациенту | VET-013 |

---

## 2. Протоколы осмотра

| # | Сценарий | Шаги | Ожидаемый результат | Артефакт |
|---|----------|------|----------------------|----------|
| 2.1 | Создание протокола (кардио) | Карточка пациента → «Новый протокол» → выбрать тип «Кардиология» → заполнить поля → Сохранить | Протокол сохранён, отображается в списке у пациента | VET-016, VET-024 |
| 2.2 | Создание протокола (УЗИ, стомат) | Аналогично для типов УЗИ и Стоматология | Протокол создаётся по выбранному шаблону | VET-016 |
| 2.3 | Редактирование протокола | Открыть протокол → иконка редактирования → изменить поля → Сохранить | Изменения сохранены, при повторном открытии — актуальные данные | VET-047, VET-022 |
| 2.4 | Тип протокола при создании и редактировании | При создании — выбор типа; при редактировании — тип не меняется | Тип доступен только при добавлении (VET-053) | VET-053 |
| 2.5 | Список протоколов по пациенту | После сохранения нового протокола остаться на карточке пациента | Список протоколов обновлён без перезагрузки (VET-038) | VET-038 |
| 2.6 | Просмотр протокола | Открыть протокол → «Данные осмотра» | Все поля, картинки, приложенные аудио отображаются; подписи полей на русском | VET-050, VET-059 |

---

## 3. Шаблоны и версии

| # | Сценарий | Шаги | Ожидаемый результат | Артефакт |
|---|----------|------|----------------------|----------|
| 3.1 | Список версий по типу | Админка → Редактор шаблонов / версии → выбрать тип протокола | Список версий шаблона с указанием активной | VET-081, VET-072 |
| 3.2 | «Сделать активной» | В списке версий → «Сделать активной» для другой версии | Только одна версия активна; при создании протокола подставляется активная | VET-071, VET-072 |
| 3.3 | Редактор по row id | Открыть редактор шаблона по версии (row id) | Редактируется выбранная версия шаблона | VET-082 |
| 3.4 | ValidationSettings → редактор | Настройки валидации → переход в редактор | Открывается редактор активной версии шаблона | VET-083 |
| 3.5 | Создание протокола — активная версия | Новый протокол → выбор типа | Форма строится по активной версии шаблона этого типа | VET-084 |
| 3.6 | Открытие протокола с сохранённой версией | Открыть существующий протокол (с привязкой к версии шаблона) | Шаблон загружается по версии; при отсутствии версии — fallback и/или предупреждение в UI | VET-080 |

---

## 4. Печатная форма и PDF

| # | Сценарий | Шаги | Ожидаемый результат | Артефакт |
|---|----------|------|----------------------|----------|
| 4.1 | Генерация PDF | Протокол → сформировать/открыть PDF | PDF создаётся, открывается в просмотрщике | VET-025 |
| 4.2 | Кириллица в PDF | PDF с русским текстом (заголовки, данные пациента, анамнез, поля) | Русские символы отображаются корректно (не квадраты) | VET-001 |
| 4.3 | Фото в PDF | Протокол с прикреплёнными фото → PDF | Фотографии отображаются в PDF | VET-002 |
| 4.4 | Шапка и разделы в печати | PDF протокола | Шапка с данными пациента; разделы в заданном порядке; наименования разделов жирным | VET-096, VET-102 |
| 4.5 | Рамки разделов/полей | В шаблоне включена рамка (прямоугольная/скруглённая) → PDF | В PDF отображается рамка согласно настройкам | VET-103, VET-107 |
| 4.6 | Визуальный редактор печати | Редактор шаблона → «Расположение на странице» / визуальный редактор | Превью печатной формы; перетаскивание разделов; ресайз (pinch или за границу); сохранение позиции и размера | VET-069, VET-095, VET-097, VET-098 |
| 4.7 | Раздел «Фотографии» в печати | Настройка «фото в ряд», авто-высота → PDF | Фото выводятся по настройкам (1–4 в ряд и т.д.) | VET-101 |
| 4.8 | Перенос раздела на следующую страницу | Протокол с длинным содержимым → PDF | Не влезающая часть раздела переносится на следующую страницу; учёт полей печати | VET-117 |

---

## 5. Экспорт и импорт

| # | Сценарий | Шаги | Ожидаемый результат | Артефакт |
|---|----------|------|----------------------|----------|
| 5.1 | Экспорт JSON | Админка → Экспорт → JSON | Файл JSON скачивается/сохраняется; содержит пациентов, протоколы, шаблоны | VET-035 |
| 5.2 | Экспорт ZIP с медиа | Админка → Экспорт → ZIP с медиа | Архив содержит JSON и медиафайлы (фото, аудио) | VET-004, VET-035 |
| 5.3 | templateType/templateVersion в экспорте | Экспорт → открыть JSON | В данных протоколов/шаблонов присутствуют templateType и templateVersion (или аналог) | VET-085, VET-088 |
| 5.4 | Импорт JSON, отчёт | Админка → Импорт → выбрать JSON → выполнить | Импорт завершён; отображается отчёт (добавлено/обновлено/пропущено, ошибки) | VET-036, VET-003 |
| 5.5 | Отсутствующие версии шаблонов при импорте | Импорт JSON с версией шаблона, которой нет в системе | В отчёте предупреждение об отсутствующих версиях (если реализовано) | VET-086 |
| 5.6 | Экспорт/импорт шаблонов из формы редактирования | Редактор шаблона (версия) → Экспорт шаблона; Админка/редактор → Импорт шаблона с проверкой ID+версия | Экспорт версии в файл; при импорте — добавление новой версии или обновление существующей по ID+версия | VET-093 |

---

## 6. Админка

| # | Сценарий | Шаги | Ожидаемый результат | Артефакт |
|---|----------|------|----------------------|----------|
| 6.1 | Вход в админку | Меню / шестерёнка → «Вход администратора» → пароль | Открывается панель администратора | VET-031 |
| 6.2 | Выход из админки | В админке → кнопка «Выход» | Переход на список пациентов (не на страницу входа в админку) | VET-037 |
| 6.3 | Навигация по разделам админки | Редактор шаблонов, Справочники, Настройки валидации, Экспорт, Импорт | Все разделы открываются без ошибок | VET-032, VET-033, VET-034 |

---

## Результат прогона

При проведении регрессии заполнять:

- **Дата прогона:**
- **Версия/ветка:**
- **Исполнитель:**
- По каждому сценарию: **OK** / **Fail** (кратко описание); при Fail — указать артефакт/баг при необходимости.

Итог: все сценарии OK или заведены дефекты в [BUGS.md](BUGS.md) с привязкой к артефактам.
